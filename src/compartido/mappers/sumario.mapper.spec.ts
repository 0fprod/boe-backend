import { readFileSync } from 'fs';
import { Sumario } from '../api-models';
import { Boe, construirBoe } from '../models';
import { mapSumarioABoe } from './sumario.mapper';

describe('Boe Mapper specs', () => {
  it.each([undefined, null, {}, []])('Devuelve un BOE vacío si el parámetro es [%s]', (parametroInvalido) => {
    const defaultBoe = construirBoe();
    expect(mapSumarioABoe(parametroInvalido as Sumario)).toStrictEqual(defaultBoe);
  });

  it('Transforma un Sumario en un BOE', () => {
    const boe = readFileSync('./test/mocks/json/boe.json', { encoding: 'utf-8' });
    const sumario: Boe = mapSumarioABoe(JSON.parse(boe));
    expect(sumario).toEqual({
      idContratos: [
        'BOE-B-2020-27644',
        'BOE-B-2020-27645',
        'BOE-B-2020-27646',
        'BOE-B-2020-27647',
        'BOE-B-2020-27648',
        'BOE-B-2020-27649',
        'BOE-B-2020-27650',
        'BOE-B-2020-27651',
        'BOE-B-2020-27652',
        'BOE-B-2020-27653',
        'BOE-B-2020-27654',
        'BOE-B-2020-27655',
        'BOE-B-2020-27656',
        'BOE-B-2020-27657',
        'BOE-B-2020-27659',
        'BOE-B-2020-27660',
        'BOE-B-2020-27661',
        'BOE-B-2020-27662',
        'BOE-B-2020-27663',
        'BOE-B-2020-27664',
        'BOE-B-2020-27665',
        'BOE-B-2020-27667',
        'BOE-B-2020-27668',
        'BOE-B-2020-27669',
        'BOE-B-2020-27670',
        'BOE-B-2020-27671',
        'BOE-B-2020-27672',
        'BOE-B-2020-27677',
        'BOE-B-2020-27678',
        'BOE-B-2020-27679',
        'BOE-B-2020-27681',
        'BOE-B-2020-27682',
        'BOE-B-2020-27683',
      ],
    });
  });

  it('Transforma un Sumario con varios diarios en un BOE', () => {
    const boe = readFileSync('./test/mocks/json/boe-varios-diarios.json', { encoding: 'utf-8' });
    const sumario: Boe = mapSumarioABoe(JSON.parse(boe));
    expect(sumario).toEqual({
      idContratos: [
        'BOE-B-2021-51717',
        'BOE-B-2021-51718',
        'BOE-B-2021-51719',
        'BOE-B-2021-51720',
        'BOE-B-2021-51721',
        'BOE-B-2021-51722',
        'BOE-B-2021-51723',
        'BOE-B-2021-51724',
        'BOE-B-2021-51725',
        'BOE-B-2021-51726',
        'BOE-B-2021-51727',
        'BOE-B-2021-51728',
        'BOE-B-2021-51729',
        'BOE-B-2021-51730',
        'BOE-B-2021-51731',
        'BOE-B-2021-51732',
        'BOE-B-2021-51733',
        'BOE-B-2021-51734',
        'BOE-B-2021-51735',
        'BOE-B-2021-51736',
        'BOE-B-2021-51737',
        'BOE-B-2021-51738',
        'BOE-B-2021-51739',
        'BOE-B-2021-51740',
        'BOE-B-2021-51741',
        'BOE-B-2021-51742',
        'BOE-B-2021-51743',
        'BOE-B-2021-51744',
        'BOE-B-2021-51745',
        'BOE-B-2021-51746',
        'BOE-B-2021-51748',
        'BOE-B-2021-51749',
        'BOE-B-2021-51750',
        'BOE-B-2021-51753',
        'BOE-B-2021-51754',
        'BOE-B-2021-51755',
        'BOE-B-2021-51756',
        'BOE-B-2021-51757',
        'BOE-B-2021-51758',
        'BOE-B-2021-51759',
        'BOE-B-2021-51760',
        'BOE-B-2021-51761',
        'BOE-B-2021-51765',
        'BOE-B-2021-51766',
        'BOE-B-2021-51772',
        'BOE-B-2021-51773',
        'BOE-B-2021-51774',
        'BOE-B-2021-51775',
        'BOE-B-2021-51776',
        'BOE-B-2021-51789',
        'BOE-B-2021-51790',
        'BOE-B-2021-51791',
        'BOE-B-2021-51792',
        'BOE-B-2021-51793',
        'BOE-B-2021-51794',
        'BOE-B-2021-51796',
        'BOE-B-2021-51799',
        'BOE-B-2021-51800',
        'BOE-B-2021-51801',
        'BOE-B-2021-51802',
        'BOE-B-2021-51803',
        'BOE-B-2021-51804',
        'BOE-B-2021-51805',
        'BOE-B-2021-51806',
        'BOE-B-2021-51807',
        'BOE-B-2021-51808',
        'BOE-B-2021-51809',
        'BOE-B-2021-51810',
        'BOE-B-2021-51812',
        'BOE-B-2021-51813',
        'BOE-B-2021-51814',
        'BOE-B-2021-51815',
        'BOE-B-2021-51816',
        'BOE-B-2021-51817',
        'BOE-B-2021-51818',
        'BOE-B-2021-51819',
        'BOE-B-2021-51820',
        'BOE-B-2021-51821',
      ],
    });
  });
});
